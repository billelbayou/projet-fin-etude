generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AnneeUniversitaire {
  id          String      @id @default(cuid())
  niveau      EnmumNiveau
  semestres   Semestre[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  anneesNotes AnneeNote[]

  @@map("annees_universitaires")
}

enum EnmumNiveau {
  L1
  L2
  L3
}

model AnneeNote {
  id            String             @id @default(cuid())
  annee         String
  etudiant      Etudiant           @relation(fields: [etudiantId], references: [id])
  etudiantId    String
  anneeUniv     AnneeUniversitaire @relation(fields: [anneeUnivId], references: [id])
  anneeUnivId   String
  moyenne       Float?
  credits       Int?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  semestreNotes SemestreNote[]

  @@unique([etudiantId, anneeUnivId, annee])
  @@map("annee_notes")
}

// Updated Etudiant model (remove anneeUniversitaire relation)
model Etudiant {
  id                      String              @id
  numeroInscription       String              @unique
  dateNaissance           DateTime?
  lieuNaissance           String?
  domaine                 String?
  filiere                 String?
  specialite              String?
  anneeUniversitaireDebut String?
  typeDiplome             TypeDiplome?        @default(licence)
  progression             ProgressionEtudiant @default(initial)
  utilisateur             Utilisateur         @relation(fields: [id], references: [id], onDelete: Cascade)
  notesSemestres          SemestreNote[]
  notesUnites             UniteNote[]
  notesModules            ModuleNote[]
  notesAnnees             AnneeNote[]

  @@map("etudiants")
}

// Semestre remains unchanged from your original
model Semestre {
  id           String             @id @default(cuid())
  nom          String
  ordre        Int
  unites       Unite[]
  annee        AnneeUniversitaire @relation(fields: [anneeId], references: [id])
  anneeId      String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  SemestreNote SemestreNote[]

  @@map("semestres")
}

model Utilisateur {
  id               String    @id @default(cuid())
  email            String    @unique
  motDePasse       String
  role             Role
  nom              String
  prenom           String
  dateCreation     DateTime  @default(now())
  dateModification DateTime  @updatedAt
  etudiant         Etudiant?

  @@map("utilisateurs")
}

model Unite {
  id         String      @id @default(cuid())
  nom        String
  semestre   Semestre    @relation(fields: [semestreId], references: [id])
  semestreId String
  modules    Module[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  UniteNote  UniteNote[]

  @@map("unites")
}

model Module {
  id          String       @id @default(cuid())
  nom         String
  credits     Int
  coefficient Float
  unite       Unite        @relation(fields: [uniteId], references: [id])
  uniteId     String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  ModuleNote  ModuleNote[]

  @@map("modules")
}

model SemestreNote {
  id          String    @id @default(cuid())
  etudiant    Etudiant  @relation(fields: [etudiantId], references: [id])
  etudiantId  String
  semestre    Semestre  @relation(fields: [semestreId], references: [id])
  semestreId  String
  note        Float
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  anneeNote   AnneeNote @relation(fields: [anneeNoteId], references: [id])
  anneeNoteId String

  @@unique([etudiantId, semestreId, anneeNoteId])
  @@map("semestre_notes")
}

model UniteNote {
  id         String   @id @default(cuid())
  etudiant   Etudiant @relation(fields: [etudiantId], references: [id])
  etudiantId String
  unite      Unite    @relation(fields: [uniteId], references: [id])
  uniteId    String
  note       Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([etudiantId, uniteId])
  @@map("unite_notes")
}

model ModuleNote {
  id         String   @id @default(cuid())
  etudiant   Etudiant @relation(fields: [etudiantId], references: [id])
  etudiantId String
  module     Module   @relation(fields: [moduleId], references: [id])
  moduleId   String
  note       Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([etudiantId, moduleId])
  @@map("module_notes")
}

enum Role {
  admin
  etudiant
}

enum TypeDiplome {
  licence
  master
}

enum ProgressionEtudiant {
  initial
  informationComplete
  transcriptConfigured
  transcriptFilled
}
